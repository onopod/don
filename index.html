<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>テンキーでドン・カッ（キー割り当て変更版）</title>
<style>
  body { font-family: sans-serif; padding: 1em; }
  #status { margin-bottom: 1em; }
</style>
</head>
<body>

<h1>テンキーでドン・カッを鳴らす（キー割り当て変更）</h1>
<p>キー1, 2 → don.wav（ドン）</p>
<p>キー4, 5 → kat.wav（カッ）</p>
<p>連打制御（100ms間隔）あり</p>
<div id="status">準備中...</div>

<script src="./posmp.js"></script>
<script>
(async () => {
  const statusDiv = document.getElementById("status");
  let samplerDon = null;
  let samplerKat = null;

  try {
    samplerDon = await new posmp("./don.wav");
    samplerKat = await new posmp("./kat.wav");
    statusDiv.textContent = "音源ロード完了。キーで再生できます。";
  } catch(e) {
    statusDiv.textContent = "音源の読み込みに失敗しました。";
    console.error(e);
    return;
  }

  async function resumeAudioContext() {
    if(samplerDon && samplerDon.audioCtx && samplerDon.audioCtx.state === "suspended") {
      await samplerDon.audioCtx.resume();
      console.log("AudioContext resumed");
    }
  }

  // ドンに割り当てるキーコード配列
  const donKeys = ["Numpad1", "Numpad2"];
  // カッに割り当てるキーコード配列
  const katKeys = ["Numpad4", "Numpad5"];

  let lastKey = null;
  let lastTime = 0;
  const debounceMs = 100; // 100ms以内の連続同キーは無視

  window.addEventListener("keydown", async (e) => {
    const now = Date.now();
    if (e.code === lastKey && (now - lastTime) < debounceMs) {
      // 連打制御で無視
      return;
    }
    lastKey = e.code;
    lastTime = now;

    await resumeAudioContext();

    if (donKeys.includes(e.code)) {
      samplerDon.play();
    } else if (katKeys.includes(e.code)) {
      samplerKat.play();
    }
  });
})();
</script>

</body>
</html>
